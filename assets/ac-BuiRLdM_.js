import{L as r,w as v,a as k,b as E,c as T,i as _}from"./marker-shadow-BFPcD4e1.js";L.Control.Bar=L.Control.extend({includes:L.Mixin.Events,options:{position:"top",visible:"true"},initialize:function(o,t){L.setOptions(this,t);var e=this._contentContainer=L.DomUtil.get(o);e.parentNode.removeChild(e);var n=this.options.visible?"visible":"",i=this._container=L.DomUtil.create("div","leaflet-control-bar-"+this.options.position+" leaflet-control-bar "+n);L.DomUtil.addClass(e,"leaflet-control"),i.appendChild(e)},addTo:function(o){var t=this._container,e=this._contentContainer;L.DomEvent.on(t,"transitionend",this._handleTransitionEvent,this).on(t,"webkitTransitionEnd",this._handleTransitionEvent,this);var n=o._controlContainer;n.insertBefore(t,n.firstChild),this._map=o;var i=L.DomEvent.stopPropagation;return L.DomEvent.on(e,"contextmenu",i).on(e,"click",i).on(e,"mousedown",i).on(e,"touchstart",i).on(e,"dblclick",i).on(e,"mousewheel",i).on(e,"MozMousePixelScroll",i),this},removeFrom:function(o){this.hide();var t=this._contentContainer,e=o._controlContainer;e.removeChild(this._container),this._map=null;var n=L.DomEvent.stopPropagation;return L.DomEvent.off(t,"contextmenu",n).off(t,"click",n).off(t,"mousedown",n).off(t,"touchstart",n).off(t,"dblclick",n).off(t,"mousewheel",n).off(t,"MozMousePixelScroll",n),L.DomEvent.off(container,"transitionend",this._handleTransitionEvent,this).off(container,"webkitTransitionEnd",this._handleTransitionEvent,this),this},isVisible:function(){return L.DomUtil.hasClass(this._container,"visible")},show:function(){this.isVisible()||(L.DomUtil.addClass(this._container,"visible"),this.fire("show"))},hide:function(o){this.isVisible()&&(L.DomUtil.removeClass(this._container,"visible"),this.fire("hide")),o&&L.DomEvent.stopPropagation(o)},toggle:function(){this.isVisible()?this.hide():this.show()},getContainer:function(){return this._contentContainer},setContent:function(o){return this.getContainer().innerHTML=o,this},_handleTransitionEvent:function(o){(o.propertyName=="left"||o.propertyName=="right"||o.propertyName=="bottom"||o.propertyName=="top")&&this.fire(this.isVisible()?"shown":"hidden")}});L.control.bar=function(o,t){return new L.Control.Bar(o,t)};class M{constructor(t){this.map=t,this.buttons=new N(this.map)}}class N{constructor(t){this.guide=r.easyButton("fa-question",()=>{window.open("https://github.com/mrt-map/map/wiki/City-Map","_blank")},"Guide").setPosition("topright").addTo(t),this.home=r.easyButton("fa-house",()=>{window.open("./","_self")},"Return to MRT City Map").setPosition("topright").addTo(t)}}function f(){return window.acGlobals}const g=document.getElementById("importer");function y(){const o=[];return a.getLayers().forEach(t=>{const e={type:"feature",geometry:{type:t instanceof r.Circle?"point":"polygon",coordinates:[]},properties:{space:t.options.color=="#ff0000"?"city":"airport",shape:t.pm.getShape(),color:t.options.color}};if(t instanceof r.Circle){e.properties.radius=t.getRadius();const n=t.getLatLng();e.geometry.coordinates=[n.lat,n.lng]}else{const n=t.getLatLngs();e.geometry.coordinates=n.map(i=>i.map(l=>[l.lat,l.lng]))}o.push(e)}),{type:"FeatureCollection",features:o}}function C(o){o.features.forEach(t=>{t.properties.shape=="Circle"?a.addLayer(r.circle(t.geometry.coordinates,{color:t.properties.color,radius:t.properties.radius}).addTo(f().map)):t.properties.shape=="Rectangle"?a.addLayer(r.rectangle([t.geometry.coordinates[0],t.geometry.coordinates[2]],{color:t.properties.color}).addTo(f().map)):a.addLayer(r.polygon(t.geometry.coordinates,{color:t.properties.color}).addTo(f().map))})}function A(){const o=g.files?.[0];if(o===void 0)return;const t=new FileReader;t.onload=function(){w("Do you want to clear all polygons?");const e=JSON.parse(t.result?.toString()??"");g.value="",C(e),m("New polygons imported")},t.readAsText(o)}g.oninput=A;window.addEventListener("beforeunload",()=>{window.localStorage.airportcalc=JSON.stringify(y())});const D="2.2.1 (20240104)",a=r.layerGroup([]),d=r.control.bar("bar",{position:"bottom",visible:!1});let u="city",p="";function S(){const o=f().map;o.pm.setGlobalOptions({layerGroup:a,pathOptions:{color:"#ff0000"}}),o.pm.Toolbar.createCustomControl({name:"cityspace",title:"City Space",block:"custom",className:"fas fa-city icon",toggle:!1,onClick:()=>{o.pm.setGlobalOptions({layerGroup:a,pathOptions:{color:"#ff0000"}}),u="city"}}),o.pm.Toolbar.createCustomControl({name:"airportspace",title:"Airport Space",block:"custom",className:"fas fa-plane icon",toggle:!1,onClick:()=>{o.pm.setGlobalOptions({layerGroup:a,pathOptions:{color:"#00dd00"}}),u="airport"}}),o.pm.Toolbar.createCustomControl({name:"clearall",title:"Clear All",block:"custom",className:"fas fa-times icon",toggle:!1,onClick:()=>{w("Are you sure you want to clear all polygons?")}}),o.pm.Toolbar.createCustomControl({name:"export",title:"Export",block:"custom",className:"fas fa-file-export icon",toggle:!1,onClick:()=>{const t=document.getElementById("downloader"),e="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(y(),null,2));t.href=e,t.download="city.apc",t.click(),m("Polygons exported")}}),o.pm.Toolbar.createCustomControl({name:"import",title:"Import",block:"custom",className:"fas fa-file-import icon",toggle:!1,onClick:()=>{document.getElementById("importer").click()}}),o.pm.addControls({position:"bottomleft",drawCircleMarker:!1,drawPolyline:!1,drawMarker:!1}),setInterval(()=>{let[t,e,n]=x();isNaN(n)&&(n=0);const i=`<img src="ac2-dark.png" style="height: 100%; float: right;">
          <b>City area size:</b> ${Math.round(t)}m^2
          <b>| Airport area size:</b> ${Math.round(e)}m^2
          <b>| Percentage:</b> <span style="color: ${n<50?"green":"red"};">${Math.round(n*100)/100}%</span>
          <b>| Drawing for:</b> ${u}`+(p!=""?`<br><b>${p}</b>`:"");d.getContainer()?.innerHTML!=i&&d.setContent(i)},50),window.localStorage.airportcalc!=null&&(C(JSON.parse(window.localStorage.airportcalc)),delete window.localStorage.airportcalc),o.addLayer(a),o.addControl(d),d.show(),m("Airportcalc "+D)}function w(o){a.getLayers().length!=0&&confirm(o)&&(a.clearLayers(),m("Polygons cleared"))}function x(){let o=0,t=0;return a.getLayers().forEach(e=>{let n=0;if(e instanceof r.Polygon)for(let i=0;i<e.getLatLngs().length;i++){let l=0;const c=e.getLatLngs()[i].map(s=>v([s.lat,s.lng]));for(let s=0;s<c.length;s++){const b=c[s];let h=c[s+1];s==c.length-1&&(h=c[0]),l+=.5*(b[1]+h[1])*(h[0]-b[0])}i==0?n+=Math.abs(l):n-=Math.abs(l)}else{const i=e.getRadius()*64;n=Math.PI*i**2}e.options.color=="#ff0000"?o+=Math.abs(n):t+=Math.abs(n)}),[o,t,t/o*100]}function m(o){p=o,setTimeout(()=>{p==o&&(p="")},3e3)}delete r.Icon.Default.prototype._getIconUrl;r.Icon.Default.mergeOptions({iconRetinaUrl:T,iconUrl:E,shadowUrl:k});window.acGlobals=new M(_());S();
